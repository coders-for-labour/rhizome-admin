link(rel="import", href="/bower_components/polymer/polymer.html")
link(rel="import", href="/bower_components/iron-ajax/iron-ajax.html")
link(rel="import", href="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html")
link(rel="import", href="../c4c-app/c4c-behaviors.html")

dom-module#c4c-data-service
  script(src="c4c-data-service.js")
  template
    style.
      :host {
        display: none;
      }

    iron-ajax#ajaxService(
      url="{{rqUrl}}",
      handleAs="json",
      method="{{rqMethod}}",
      content-type="{{rqContentType}}",
      params="{{rqParams}}",
      body="{{rqBody}}",
      on-response="__ajaxResponse",
      on-error="__ajaxError",
      last-response="{{rqResponse}}"
      )

    //iron-ajax#ajaxService(
      url="{{vectorBaseUrl}}",
      handleAs="json",
      on-response="__ajaxResponse",
      on-error="__ajaxError",
      )


    iron-ajax#addService(
    url="[[vectorBaseUrl]]",
    method="POST",
    content-type="application/x-www-form-urlencoded",
    handleAs="json",
    last-response="{{addResponse}}"
    )
    iron-ajax#putService(
    url="[[scalarBaseUrl]]",
    method="PUT",
    content-type="application/x-www-form-urlencoded",
    handleAs="json",
    last-response="{{updateResponse}}"
    )
    iron-ajax#rmService(
    url="[[scalarBaseUrl]]",
    method="DELETE",
    handleAs="json",
    last-response="{{rmResponse}}"
    )

    //- When bower_components is removed, or overwritten
    //- Need to use the adjusted version that forces the workerUrl
    //- if (!this.workerUrl) {
    //-   this.workerUrl = this.resolveUrl('./app-indexeddb-mirror-worker.js');
    //- }
    app-indexeddb-mirror(
    key="{{route}}",
    data="{{liveData}}",
    persisted-data="{{data}}"
    )

